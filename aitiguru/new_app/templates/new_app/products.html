{% load mptt_tags %}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞—Ç–∞–ª–æ–≥</title>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 0; }
        .header { padding: 10px; background: #f8f8f8; border-bottom: 1px solid #ddd; display:flex; justify-content:space-between; align-items:center; }
        .container { display: flex; }
        .sidebar { width: 250px; padding: 10px; border-right: 1px solid #ddd; display: none; }
        .products { flex: 1; padding: 20px; }
        ul { list-style: none; padding-left: 15px; margin: 0; }
        li { margin: 4px 0; }
        a { text-decoration: none; color: #007bff; }
        a:hover { text-decoration: underline; }
        .category-toggle { cursor: pointer; font-weight: bold; }
        .auth-block { font-size: 14px; }
        .logout-form { display: inline; margin: 0; padding: 0; }
        .logout-btn { background: none; border: none; color: #007bff; cursor: pointer; padding: 0; font: inherit; }
        .logout-btn:hover { text-decoration: underline; }
    </style>
    <script>
        function toggleSidebar() {
            const sidebar = document.querySelector(".sidebar");
            sidebar.style.display = (sidebar.style.display === "block") ? "none" : "block";
            localStorage.setItem("sidebarVisible", sidebar.style.display);
        }

        window.onload = function() {
            const sidebar = document.querySelector(".sidebar");
            const savedState = localStorage.getItem("sidebarVisible");
            sidebar.style.display = savedState ? savedState : "none";
        }
    </script>
</head>
<body>

<div class="header">
    <span class="category-toggle" onclick="toggleSidebar()">‚ò∞ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</span>

    <div class="auth-block">
        {% if user.is_authenticated %}
            <li class="last">
{#                <a href="{% url 'users:profile' %}">{{ user.username }}</a> |#}
                <a href="{% url 'users:profile' %}">{{ user.username }}</a> |
                <a href="{% url 'cart_view' %}">üõí</a> |
                <form action="{% url 'users:logout' %}" method="post" class="logout-form">
                    {% csrf_token %}
                    <button type="submit" class="logout-btn">–í—ã–π—Ç–∏</button>
                </form>
            </li>
        {% else %}
            <li class="last">
                <a href="{% url 'users:login' %}">–í–æ–π—Ç–∏</a> |
                <a href="{% url 'users:register' %}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
{#                <a href="{% url 'users:register' %}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>#}
            </li>
        {% endif %}
    </div>
</div>

<div class="container">
    <div class="sidebar">
        <ul>
            {% for cat in root_categories %}
                {% include "new_app/category_node.html" with node=cat current_category=current_category %}
            {% endfor %}
        </ul>
    </div>

    <div class="products">
        {% if current_category %}
            <h2>–¢–æ–≤–∞—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {{ current_category.title }}</h2>
        {% else %}
            <h2>–í—Å–µ —Ç–æ–≤–∞—Ä—ã</h2>
        {% endif %}

        {% for product in products %}
            <div>
                <strong>{{ product.title }}</strong> <a href="{% url 'produ' product.pk %}">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</a> <br>
                –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ product.cat.title }}<br>
                –¶–µ–Ω–∞: {{ product.price }}<br>
                –ö–æ–ª-–≤–æ: {{ product.count }}
            </div>

            <form action="{% url 'add_to_cart' product.id %}" method="post">
                {% csrf_token %}
                <input type="number" name="quantity" value="1" min="1" max="{{ product.count }}">
                <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
            </form>
            <hr>
        {% empty %}
            <p>–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤.</p>
        {% endfor %}

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->

<style>
/* –°—Ç–∏–ª–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ */
.list-pages {
    margin: 24px 0;
    text-align: center;
}

.list-pages ul {
    display: inline-flex;
    list-style: none;
    padding: 0;
    margin: 0;
    gap: 6px;
    flex-wrap: wrap;
    justify-content: center;
}

.list-pages .page-num {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    font-size: 15px;
    font-weight: 500;
    border: 1px solid #ddd;
    border-radius: 6px;
    background: #fff;
    color: #007bff;
    text-decoration: none;
    transition: all 0.2s ease;
    box-sizing: border-box; /* –≤–∞–∂–Ω–æ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ */
}

.list-pages .page-num a {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    color: #007bff;
    text-decoration: none;
}

.list-pages .page-num a:hover {
    color: #0056b3;
    background-color: #f8f9fa;
}

.list-pages .page-num.page-num-selected {
    background-color: #007bff;
    color: white;
    border-color: #007bff;
    cursor: default;
    /* –ù–∏–∫–∞–∫–æ–π —Å—Å—ã–ª–∫–∏ –≤–Ω—É—Ç—Ä–∏ ‚Äî —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç, –Ω–æ –æ–Ω —Ç–æ–∂–µ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω */
}

.list-pages .page-num.page-num-selected a {
    color: white;
    pointer-events: none;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 480px) {
    .list-pages .page-num {
        min-width: 32px;
        height: 32px;
        font-size: 14px;
    }
}
</style>

{% if page_obj.has_other_pages %}
<nav class="list-pages">
    <ul>
        <!-- –°—Ç—Ä–µ–ª–∫–∞ "–ü—Ä–µ–¥—ã–¥—É—â–∞—è" -->
        {% if page_obj.has_previous %}
        <li class="page-num">
            <a href="?page={{ page_obj.previous_page_number }}" title="–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"><</a>
        </li>
        {% endif %}

        <!-- –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü (—Å –æ–∫–Ω–æ–º ¬±2 –æ—Ç —Ç–µ–∫—É—â–µ–π) -->
        {% for p in paginator.page_range %}
            {% if page_obj.number == p %}
                <li class="page-num page-num-selected">{{ p }}</li>
            {% elif p >= page_obj.number|add:-2 and p <= page_obj.number|add:2 %}
                <li class="page-num">
                    <a href="?page={{ p }}">{{ p }}</a>
                </li>
            {% endif %}
        {% endfor %}

        <!-- –°—Ç—Ä–µ–ª–∫–∞ "–°–ª–µ–¥—É—é—â–∞—è" -->
        {% if page_obj.has_next %}
        <li class="page-num">
            <a href="?page={{ page_obj.next_page_number }}" title="–°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞">></a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}

    </div>
</div>

</body>
</html>


